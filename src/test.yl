[def test exports]

[Section: testing library
  [def proto
    [new object
      ['fail
        [fn [message]
          [console log 'Test\ failure: [this get 'name] message]
          this]]
      ['assertEqual
        [fn [a b] 
        [console log 'AssertEqual a b '( [this get 'name] ')]
        [try-catch e
            [if [[[JSON stringify a] == [JSON stringify b]] fails]
                [console log 'Error\ not\ equal a b 'in [this get 'name]]]
            [console log 'Error\ could\ not\ compare a b 'in [test get 'name] 'error: e]]
            this
            ]]
      ['done [fn [] [console log 'Test\ done [this get 'name]] this]]]]
  [test set
    'case
    [fn [name]
      [console log 'Starting\ testcase: name]
      [def result [Object create proto]]
      [result set 'name name]
      result]]]

[def yolan [module require './yolan]]

[test set
  'run
  [fn [args]
    [Section: yolan test
      [def testcase [test case 'yolanIO]]
      [yolan writeTextFile
        'test-tmp/yolanIOtest
        'testvalue
        [fn [err]
          [if err [testcase fail 'writeError]]
          [yolan readTextFile
            'test-tmp/yolanIOtest
            [fn [err data]
              [if err [testcase fail 'readError]]
              [testcase assertEqual data 'testvalue]
              [testcase done]]]]]]
    undefined]]
